<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
    xmlns:h="http://xmlns.jcp.org/jsf/html"
    xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
    xmlns:f="http://xmlns.jcp.org/jsf/core">

<h:head>
    <meta charset="utf-8" />
    <title>SIGAPAR - Sistema</title>

    <!-- CSS principal -->
    <h:outputStylesheet name="css/app.css"/>

    <!-- Evita cache após logout -->
    <meta http-equiv="Cache-Control" content="no-store" />
</h:head>

<h:body>

    <!-- Top Bar -->
    <div class="top-bar">

        <!-- Logo -->
        <a href="#{facesContext.externalContext.requestContextPath}/index.xhtml"
           class="brand">
            SIGAPAR
        </a>

        <!-- FORM para os botões funcionarem -->
        <h:form>

            <div class="menu">

                <h:link outcome="/index.xhtml" value="Início" />

                <!-- SE ESTIVER LOGADO -->
                <ui:fragment rendered="#{not empty loginController.usuarioLogado}">

                    <!-- Usuário comum -->
                    <ui:fragment rendered="#{loginController.temRole('ROLE_USER')}">
                        <h:link outcome="/agendamento/agendar.xhtml" value="Agendar" />
                        <h:link outcome="/agendamento/meus.xhtml" value="Meus Agendamentos" />
                    </ui:fragment>

                    <!-- Painel sempre pode ser visto por qualquer usuário logado -->
                    <h:link outcome="/publico/painel.xhtml" value="Painel de Chamadas" />

                    <!-- Recepção -->
                    <ui:fragment rendered="#{loginController.temRole('ROLE_RECEPTIONIST') 
                                              or loginController.temRole('ROLE_ADMIN')}">
                        <h:link outcome="/recepcao/dashboard.xhtml" value="Recepção" />
                    </ui:fragment>

                    <!-- Atendente -->
                    <ui:fragment rendered="#{loginController.temRole('ROLE_ATTENDANT') 
                                              or loginController.temRole('ROLE_ADMIN')}">
                        <h:link outcome="/atendente/home.xhtml" value="Atendente" />
                    </ui:fragment>

                    <!-- Admin -->
                    <ui:fragment rendered="#{loginController.temRole('ROLE_ADMIN')}">
                        <h:link outcome="/admin/dashboard.xhtml" value="Administração" />
                    </ui:fragment>

                    <!-- Nome do usuário sem risco de nullpointer -->
                    <span style="margin-left: 20px; color: #eee;">
                        Olá,
                        #{(loginController.usuarioLogado.nome ne null and
                           loginController.usuarioLogado.nome ne '')
                           ? loginController.usuarioLogado.nome.split(' ')[0]
                           : 'Usuário'}!
                    </span>

                    <!-- LOGOUT FUNCIONANDO -->
                    <h:commandLink value="Sair"
                                   action="#{loginController.logout}"
                                   style="margin-left: 15px; color: #ff6b6b;" />
                </ui:fragment>


                <!-- SE NÃO ESTIVER LOGADO -->
                <ui:fragment rendered="#{empty loginController.usuarioLogado}">
                    <h:link outcome="/publico/escolher-acesso.xhtml" value="Entrar" />
                    <h:link outcome="/publico/cadastro.xhtml" value="Cadastrar" />
                </ui:fragment>

            </div>
        </h:form>
    </div>

    <!-- Conteúdo -->
    <div class="content container">
        <ui:insert name="conteudo" />
    </div>

    <!-- Rodapé -->
    <div class="footer">
        <p>SIGAPAR - Sistema de Gestão</p>
    </div>

</h:body>
</html>
