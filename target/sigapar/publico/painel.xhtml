<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
      xmlns:p="http://primefaces.org/ui">

<ui:composition template="/templates/layout.xhtml">
    <ui:define name="conteudo">
        <div style="height:100vh; display:flex; flex-direction:column; background:#000; color:#fff; font-family:'Segoe UI', Arial, sans-serif;">

            <!-- CHAMADA ATUAL -->
            <h:form id="formPainel">
                <div style="flex:1; display:flex; flex-direction:column; justify-content:center; align-items:center; background: linear-gradient(135deg, #d32f2f, #b71c1c); padding:40px; text-align:center; border-radius:16px; margin:20px;">
                    <h1 style="font-size:5vw; margin:0 0 20px 0; text-shadow:3px 3px 10px rgba(0,0,0,0.7);">AGORA SENDO ATENDIDO</h1>

                    <div class="nome-cliente" style="font-size:8vw; font-weight:bold; margin:20px 0; text-shadow:4px 4px 12px rgba(0,0,0,0.8);">
                        <h:outputText value="#{not empty painelController.atendimentoAtual ? painelController.atendimentoAtual.usuario.nome : 'Aguardando...'}"/>
                    </div>

                    <div class="local" style="font-size:6vw; background:#000; padding:15px 50px; border-radius:20px; margin:20px 0;">
                        <h:outputText value="GUICHÊ #{not empty painelController.atendimentoAtual and not empty painelController.atendimentoAtual.atendente and not empty painelController.atendimentoAtual.atendente.guiche ? painelController.atendimentoAtual.atendente.guiche.identificador : '---'}"/>
                    </div>
                </div>

                <!-- HISTÓRICO -->
                <div class="historico" style="background:#111; padding:20px; font-size:2.8vw; margin:20px; border-radius:12px;">
                    <h2 style="text-align:center; margin:0 0 20px 0; font-size:3.5vw; color:#ffeb3b;">ÚLTIMAS CHAMADAS</h2>

                    <ui:repeat value="#{painelController.ultimasChamadas}" var="a">
                        <div class="chamada" style="padding:12px 0; border-bottom:1px solid #333;">
                            <strong>#{a.usuario.nome}</strong> → 
                            <h:outputText value="Guichê #{not empty a.atendente and not empty a.atendente.guiche ? a.atendente.guiche.identificador : '---'}"/>
                            <small style="float:right; color:#aaa;">
                                <h:outputText value="#{not empty a.horaChamado ? a.horaChamado.format(java.time.format.DateTimeFormatter.ofPattern('HH:mm')) : ''}"/>
                            </small>
                        </div>
                    </ui:repeat>

                    <h:panelGroup rendered="#{empty painelController.ultimasChamadas}">
                        <div class="chamada" style="padding:12px 0;">Nenhuma chamada recente.</div>
                    </h:panelGroup>
                </div>

                <!-- FILA INFO -->
                <div class="fila-info" style="position:fixed; bottom:20px; right:20px; background:#ffeb3b; color:#000; padding:15px 40px; border-radius:50px; font-size:3vw; font-weight:bold; box-shadow:0 0 20px rgba(255,235,59,0.6);">
                    <h:outputText value="Na fila: #{painelController.filaSize} pessoa(s)"/>
                </div>

                <!-- ATUALIZAÇÃO AUTOMÁTICA -->
                <p:poll interval="5" listener="#{painelController.atualizarPainel}" update="formPainel" async="true"/>
            </h:form>
        </div>
    </ui:define>
</ui:composition>
</html>
