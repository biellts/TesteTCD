<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="jakarta.faces.facelets"
                xmlns:h="jakarta.faces.html"
                xmlns:f="jakarta.faces.core">

    <ui:define name="conteudo">
        <h1 style="text-align:center; margin-bottom:20px;">Criar Conta</h1>

        <div class="card" style="max-width:450px; margin:auto; padding:20px;">
            <h:form id="formCadastro">
                <h:messages style="color:red; margin-bottom:15px;" />

                <label>Nome</label>
                <h:inputText id="nome" value="#{usuarioController.usuario.nome}" style="width:100%; margin-bottom:12px;" />

                <label>Email</label>
                <h:inputText id="email" value="#{usuarioController.usuario.email}" style="width:100%; margin-bottom:12px;" />

                <label>CPF</label>
                <h:inputText id="cpf" value="#{usuarioController.usuario.cpf}" style="width:100%; margin-bottom:12px;" />

                <label>Telefone</label>
                <h:inputText id="telefone" value="#{usuarioController.usuario.telefone}" style="width:100%; margin-bottom:12px;" />

                <label>Data de Nascimento</label>
                <h:inputText id="dataNasc" value="#{usuarioController.usuario.dataNascimento}" style="width:100%; margin-bottom:12px;">
                    <f:convertDateTime pattern="dd/MM/yyyy" />
                </h:inputText>

                <label>Senha</label>
                <h:inputSecret id="senha" value="#{usuarioController.usuario.senha}" style="width:100%; margin-bottom:12px;" />

                <label>Confirmar Senha</label>
                <h:inputSecret id="senhaConfirma" style="width:100%; margin-bottom:20px;" />

                <h:commandButton value="Criar Conta" action="#{usuarioController.salvarPublico}"
                                 style="width:100%; padding:10px;" />
            </h:form>
        </div>

        <!-- Scripts das máscaras (podem ficar aqui dentro do conteudo) -->
        <script>
            document.addEventListener("input", function(e) {
                // CPF
                if (e.target.matches("#formCadastro\\:cpf, [id$=':cpf']")) {
                    let v = e.target.value.replace(/\D/g, "");
                    v = v.replace(/^(\d{3})(\d)/, "$1.$2");
                    v = v.replace(/^(\d{3})\.(\d{3})(\d)/, "$1.$2.$3");
                    v = v.replace(/^(\d{3})\.(\d{3})\.(\d{3})(\d{1,2})/, "$1.$2.$3-$4");
                    v = v.replace(/(-\d{2})\d+?$/, "$1");
                    e.target.value = v;
                }
                // Telefone
                if (e.target.matches("#formCadastro\\:telefone, [id$=':telefone']")) {
                    let v = e.target.value.replace(/\D/g, "");
                    v = v.replace(/^(\d{2})(\d)/, "($1) $2");
                    v = v.replace(/(\d{4})(\d)/, "$1-$2");
                    e.target.value = v;
                }
                // Data
                if (e.target.matches("#formCadastro\\:dataNasc, [id$=':dataNasc']")) {
                    let v = e.target.value.replace(/\D/g, "");
                    v = v.replace(/^(\d{2})(\d)/, "$1/$2");
                    v = v.replace(/(\d{2})\/(\d{2})(\d)/, "$1/$2/$3");
                    e.target.value = v.substring(0,10);
                }
            });

            // Validação de senha
            document.addEventListener("DOMContentLoaded", function() {
                const senha = document.getElementById("formCadastro:senha");
                const confirma = document.getElementById("formCadastro:senhaConfirma");
                if (confirma) {
                    confirma.addEventListener("blur", function() {
                        if (senha.value !== confirma.value) {
                            alert("As senhas não coincidem!");
                            confirma.value = "";
                            confirma.focus();
                        }
                    });
                }
            });
        </script>
    </ui:define>
</ui:composition>