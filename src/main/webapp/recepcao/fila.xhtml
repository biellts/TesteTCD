<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://xmlns.jcp.org/jsf/html"
      xmlns:f="http://xmlns.jcp.org/jsf/core"
      xmlns:ui="http://xmlns.jcp.org/jsf/facelets">

<ui:composition template="/templates/layout.xhtml">

    <ui:define name="conteudo">

        <!-- TÃTULO -->
        <div style="text-align:center; padding:30px 20px;">
            <h1 style="color:#036fab; font-size:2.4em; margin:0;">
                ðŸ“‹ Fila de Atendimentos
            </h1>
            <p style="color:#666; font-size:1.15em; margin-top:10px;">
                Pesquise pacientes na fila e visualize detalhes do agendamento.
            </p>
        </div>

        <!-- CARD DE BUSCA -->
        <h:form id="formBusca">

            <div style="max-width:900px; margin:0 auto 35px;">
                <div style="
                    padding:30px;
                    border-radius:14px;
                    background:white;
                    box-shadow:0 8px 25px rgba(0,0,0,0.08);
                ">

                    <h2 style="color:#036fab; margin-bottom:20px;">Buscar Agendamento</h2>

                    <div style="display:flex; gap:25px; flex-wrap:wrap;">

                        <!-- CPF -->
                        <div style="flex:1; min-width:180px;">
                            <h:outputLabel value="CPF:" for="cpf" style="font-weight:600;" />
                            <h:inputText id="cpf"
                                         value="#{recepcaoController.buscaCpf}"
                                         maxlength="14"
                                         style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;" />
                        </div>

                        <!-- Protocolo -->
                        <div style="flex:1; min-width:180px;">
                            <h:outputLabel value="Protocolo:" for="protocolo" style="font-weight:600;" />
                            <h:inputText id="protocolo"
                                         value="#{recepcaoController.buscaProtocolo}"
                                         style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;" />
                        </div>

                        <!-- Data -->
                        <div style="flex:1; min-width:180px;">
                            <h:outputLabel value="Data:" for="data" style="font-weight:600;" />
                            <h:inputText id="data"
                                         value="#{recepcaoController.dataBusca}"
                                         type="date"
                                         style="width:100%; padding:10px; border-radius:8px; border:1px solid #ccc;" />
                        </div>

                        <!-- BotÃµes -->
                        <div style="display:flex; gap:15px; align-items:flex-end;">

                            <!-- Buscar -->
                            <h:commandButton value="Buscar"
                                             action="#{recepcaoController.buscar}"
                                             style="padding:12px 25px;
                                                    background:#28a745;
                                                    color:white;
                                                    border:none;
                                                    border-radius:8px;
                                                    font-weight:600;
                                                    cursor:pointer;" />

                            <!-- Limpar -->
                            <h:commandButton value="Limpar"
                                             action="#{recepcaoController.limpar}"
                                             style="padding:12px 25px;
                                                    background:#dc3545;
                                                    color:white;
                                                    border:none;
                                                    border-radius:8px;
                                                    font-weight:600;
                                                    cursor:pointer;" />
                        </div>

                    </div>

                </div>
            </div>

        </h:form>

        <!-- TABELA DE AGENDAMENTOS -->
        <h:form id="formTabela">

            <div style="max-width:1200px; margin:0 auto 40px;">
                <div style="
                    padding:30px;
                    border-radius:14px;
                    background:white;
                    box-shadow:0 8px 25px rgba(0,0,0,0.08);
                ">

                    <h2 style="color:#036fab; margin-bottom:25px;">Resultados</h2>

                    <h:dataTable value="#{recepcaoController.agendamentosEncontrados}"
                                 var="a"
                                 style="width:100%; border-collapse:separate; border-spacing:0 10px;">

                        <h:column>
                            <f:facet name="header"><strong>Protocolo</strong></f:facet>
                            #{a.protocolo}
                        </h:column>

                        <h:column>
                            <f:facet name="header"><strong>CPF</strong></f:facet>
                            #{a.usuario.cpf}
                        </h:column>

                        <h:column>
                            <f:facet name="header"><strong>Nome</strong></f:facet>
                            #{a.usuario.nome}
                        </h:column>

                        <h:column>
                            <f:facet name="header"><strong>Data</strong></f:facet>
                            #{recepcaoController.formatarData(a.data)}
                        </h:column>

                        <h:column>
                            <f:facet name="header"><strong>Hora</strong></f:facet>
                            #{recepcaoController.formatarHora(a.horario)}
                        </h:column>

                        <h:column>
                            <f:facet name="header"><strong>ServiÃ§o</strong></f:facet>
                            #{a.servico.nome}
                        </h:column>

                        <!-- BotÃ£o selecionar -->
                        <h:column>
                            <f:facet name="header"><strong>AÃ§Ãµes</strong></f:facet>

                            <h:commandButton value="Selecionar"
                                             action="#{recepcaoController.setAgendamentoSelecionado(a)}"
                                             style="padding:8px 18px;
                                                    background:#007bff;
                                                    color:white;
                                                    border:none;
                                                    border-radius:6px;
                                                    font-weight:600;
                                                    cursor:pointer;">
                                <f:ajax render=":formDetalhes" />
                            </h:commandButton>

                        </h:column>

                    </h:dataTable>

                    <!-- Caso nÃ£o haja resultados -->
                    <h:outputText value="Nenhum registro encontrado."
                                  rendered="#{empty recepcaoController.agendamentosEncontrados}"
                                  style="text-align:center; display:block; padding:40px; color:#888; font-size:1.2em;" />

                </div>
            </div>

        </h:form>

        <!-- DETALHES DO AGENDAMENTO -->
        <h:form id="formDetalhes">
            <h:panelGroup rendered="#{not empty recepcaoController.agendamentoSelecionado}">

                <div style="max-width:800px; margin:0 auto 50px;">
                    <div style="
                        padding:30px;
                        border-radius:14px;
                        background:white;
                        box-shadow:0 8px 25px rgba(0,0,0,0.08);
                    ">

                        <h2 style="color:#036fab; margin-bottom:20px;">Detalhes do Agendamento</h2>

                        <p><b>Protocolo:</b> #{recepcaoController.agendamentoSelecionado.protocolo}</p>
                        <p><b>Nome:</b> #{recepcaoController.agendamentoSelecionado.usuario.nome}</p>
                        <p><b>CPF:</b> #{recepcaoController.agendamentoSelecionado.usuario.cpf}</p>
                        <p><b>ServiÃ§o:</b> #{recepcaoController.agendamentoSelecionado.servico.nome}</p>
                        <p><b>Data:</b> #{recepcaoController.formatarData(recepcaoController.agendamentoSelecionado.data)}</p>
                        <p><b>Hora:</b> #{recepcaoController.formatarHora(recepcaoController.agendamentoSelecionado.horario)}</p>

                    </div>
                </div>

            </h:panelGroup>
        </h:form>

    </ui:define>

</ui:composition>
</html>
