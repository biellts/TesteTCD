<!DOCTYPE html>
<ui:composition template="/templates/layout.xhtml"
                xmlns="http://www.w3.org/1999/xhtml"
                xmlns:h="http://xmlns.jcp.org/jsf/html"
                xmlns:f="http://xmlns.jcp.org/jsf/core"
                xmlns:ui="http://xmlns.jcp.org/jsf/facelets"
                xmlns:p="http://primefaces.org/ui">

    <ui:define name="conteudo">

        <div style="max-width: 900px; margin: 0 auto; padding: 30px 20px;">

            <!-- CABEÃ‡ALHO -->
            <div style="text-align:center; margin-bottom: 40px;">
                <h1 style="color:#036fab; font-size:2.5em; margin:0; font-weight:700;">ðŸ“‹ HistÃ³rico de Atendimentos</h1>
                <p style="color:#555; font-size:1.1em; margin-top:12px;">
                    Veja todos os agendamentos associados a vocÃª como atendente.
                </p>
            </div>

            <h:messages globalOnly="true" style="margin-bottom:20px; font-size:1.1em;" />

            <!-- BUSCA -->
            <h:form id="formBusca">
                <div style="margin-bottom: 25px; text-align: center;">
                    <p:inputText value="#{historicoAtendenteController.protocoloBusca}"
                                 placeholder="Digite o protocolo (ex: AGD123456789)"
                                 style="padding:10px; width:300px; font-size:1.1em; border-radius:6px; border:1px solid #ccc;" />

                    <h:commandButton value="ðŸ” Buscar"
                                     action="#{historicoAtendenteController.buscarPorProtocolo}"
                                     style="padding:10px 20px; margin-left:10px; background:#036fab; color:white; border:none; border-radius:6px; font-weight:600;">
                        <f:ajax execute="@form" render=":formAgendamentos:agendamentoTable" />
                    </h:commandButton>

                    <h:commandButton value="Mostrar Todos"
                                     action="#{historicoAtendenteController.carregarAgendamentosDoAtendente}"
                                     style="padding:10px 20px; margin-left:10px; background:#666; color:white; border:none; border-radius:6px;">
                        <f:ajax render=":formAgendamentos:agendamentoTable" />
                    </h:commandButton>
                </div>
            </h:form>

            <!-- TABELA DE AGENDAMENTOS -->
            <h:form id="formAgendamentos">
                <h:panelGroup id="agendamentoTable">

                    <h:panelGroup rendered="#{not empty historicoAtendenteController.agendamentosDoAtendente}">
                        <table class="table_default"
                               style="width:100%; background:white; box-shadow:0 8px 25px rgba(0,0,0,0.08); border-radius:14px; overflow:hidden; font-size:1.05em; margin-top:20px;">
                            
                            <thead style="background:#036fab; color:white;">
                                <tr>
                                    <th style="padding:15px; text-align:center;">Protocolo</th>
                                    <th style="padding:15px;">Cliente</th>
                                    <th style="padding:15px;">ServiÃ§o</th>
                                    <th style="padding:15px; text-align:center;">Data</th>
                                    <th style="padding:15px; text-align:center;">HorÃ¡rio</th>
                                    <th style="padding:15px; text-align:center;">Status</th>
                                </tr>
                            </thead>

                            <tbody>
                                <ui:repeat value="#{historicoAtendenteController.agendamentosDoAtendente}" var="a">
                                    <tr style="border-bottom:1px solid #eee;">
                                        
                                        <!-- Protocolo -->
                                        <td style="padding:15px; text-align:center;">
                                            <strong style="font-family:monospace; font-size:1.1em; color:#036fab;">
                                                #{a.protocolo}
                                            </strong>
                                        </td>

                                        <!-- Cliente -->
                                        <td style="padding:15px;">#{a.usuario.nome}</td>

                                        <!-- ServiÃ§o -->
                                        <td style="padding:15px;">#{a.servico.nome}</td>

                                        <!-- Data -->
                                        <td style="padding:15px; text-align:center;">
                                            #{historicoAtendenteController.formatarData(a.data)}
                                        </td>

                                        <!-- HorÃ¡rio -->
                                        <td style="padding:15px; text-align:center;">
                                            #{historicoAtendenteController.formatarHora(a.horario)}
                                        </td>

                                        <!-- Status -->
                                        <td style="padding:15px; text-align:center;">
                                            <span style="padding:6px 12px; border-radius:18px; font-weight:600; font-size:0.9em;
                                                 #{a.status == 'AGENDADO' ? 'background:#d4edda; color:#155724;' :
                                                   a.status == 'EM_FILA' ? 'background:#fff3cd; color:#856404;' :
                                                   a.status == 'CONCLUIDO' ? 'background:#d1ecf1; color:#0c5460;' :
                                                   a.status == 'CANCELADO' ? 'background:#f8d7da; color:#721c24;' :
                                                   'background:#e2e3e5; color:#383d41;'}">
                                                #{a.status}
                                            </span>
                                        </td>

                                    </tr>
                                </ui:repeat>
                            </tbody>
                        </table>
                    </h:panelGroup>

                    <h:panelGroup rendered="#{empty historicoAtendenteController.agendamentosDoAtendente}"
                                  style="margin-top:30px; text-align:center; color:#666; font-size:1.1em;">
                        ðŸ˜• Nenhum agendamento encontrado.
                    </h:panelGroup>

                </h:panelGroup>
            </h:form>

        </div>
    </ui:define>
</ui:composition>
